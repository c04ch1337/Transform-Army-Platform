# ============================================================================
# DOCKER COMPOSE ENVIRONMENT VARIABLES
# ============================================================================
# Configuration for running Transform Army AI in Docker containers.
# Copy this file to .env and update with your actual values.
#
# NOTE: This file configures Docker Compose services. Application-level
# configuration (API keys, feature flags, etc.) should be set in the
# individual service .env files:
# - Backend: apps/adapter/.env.example
# - Frontend: apps/web/.env.example

# ============================================================================
# BUILD CONFIGURATION
# ============================================================================

# Build environment (development or production)
# Used as build arg in Dockerfiles
BUILD_ENV=production

# ============================================================================
# DATABASE CONFIGURATION (PostgreSQL)
# ============================================================================

# PostgreSQL user credentials
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=transform_army

# Database connection URL (for services inside Docker network)
# Note: Uses 'postgres' hostname (Docker service name) instead of 'localhost'
DATABASE_URL=postgresql://postgres:postgres@postgres:5432/transform_army

# Database connection pool settings (passed to adapter service)
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=10

# Database migration retry settings (for startup resilience)
DB_MAX_RETRIES=30
DB_RETRY_INTERVAL=2

# ============================================================================
# REDIS CONFIGURATION
# ============================================================================

# Redis password (leave empty for no password in development)
REDIS_PASSWORD=

# Redis connection URL (for services inside Docker network)
# Note: Uses 'redis' hostname (Docker service name) instead of 'localhost'
REDIS_URL=redis://redis:6379/0

# ============================================================================
# BACKEND SERVICE (Adapter/FastAPI)
# ============================================================================

# Number of Uvicorn worker processes
ADAPTER_WORKERS=4

# API server configuration (inside container)
ADAPTER_API_HOST=0.0.0.0
ADAPTER_API_PORT=8000

# CORS allowed origins (should match frontend URLs)
ADAPTER_CORS_ORIGINS=http://localhost:3000,http://localhost:3001

# ============================================================================
# FRONTEND SERVICE (Next.js Web App)
# ============================================================================

# Public-facing application URL (for browser access)
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Backend API URL (accessible from browser)
# In development: Use localhost:8000
# In production: Use your domain or nginx proxy URL
NEXT_PUBLIC_API_URL=http://localhost:8000

# WebSocket URL (for real-time features)
NEXT_PUBLIC_WS_URL=ws://localhost:8000

# NextAuth.js configuration
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-nextauth-secret-key-min-32-chars

# ============================================================================
# SECURITY & SECRETS
# ============================================================================

# API secret key for JWT tokens and encryption (min 32 characters)
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
# Note: This should match the value in apps/adapter/.env
API_SECRET_KEY=your-api-secret-key-min-32-chars

# ============================================================================
# MONITORING & OBSERVABILITY (Production)
# ============================================================================

# Sentry DSN for error tracking
SENTRY_DSN=

# Sentry environment tag
SENTRY_ENVIRONMENT=production

# ============================================================================
# DEVELOPMENT TOOLS (Optional - Use profile: tools)
# ============================================================================

# pgAdmin credentials (for database management UI at localhost:5050)
PGADMIN_DEFAULT_EMAIL=admin@transform-army.ai
PGADMIN_DEFAULT_PASSWORD=admin

# ============================================================================
# DEPLOYMENT NOTES
# ============================================================================
#
# LOCAL DEVELOPMENT:
# - Use localhost URLs (http://localhost:3000, http://localhost:8000)
# - Leave REDIS_PASSWORD empty
# - Use default database credentials
#
# DOCKER DEVELOPMENT (docker-compose.dev.yml):
# - Backend connects to services using Docker network names (postgres, redis)
# - Frontend uses localhost URLs (accessible from host browser)
# - Database persists in Docker volumes
#
# PRODUCTION (docker-compose.prod.yml):
# - Set strong passwords for POSTGRES_PASSWORD and REDIS_PASSWORD
# - Update all NEXT_PUBLIC_* URLs to production domains
# - Configure SENTRY_DSN for error tracking
# - Use nginx reverse proxy (included in prod compose)
# - Enable SSL/TLS certificates in nginx.conf
# - Review and adjust ADAPTER_WORKERS based on server resources